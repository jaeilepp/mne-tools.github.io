<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Permutation t-test on toy data with spatial clustering &mdash; MNE 0.12.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.3.4/flatly/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.12.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="MNE 0.12.0 documentation" href="../index.html" />
    <link rel="up" title="Tutorials" href="../tutorials.html" />
    <link rel="next" title="Spatiotemporal permutation F-test on full sensor data" href="plot_stats_spatio_temporal_cluster_sensors.html" />
    <link rel="prev" title="Brainstorm auditory tutorial dataset" href="plot_brainstorm_auditory.html" />

<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700' rel='stylesheet' type='text/css'>


    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37225609-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>



    <script type="text/javascript">
    !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);
    js.id=id;js.src="http://platform.twitter.com/widgets.js";
    fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
    </script>



    <script type="text/javascript">
    (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
    </script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><img src="../_static/mne_logo_small.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>0.12.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../getting_started.html">Get started</a></li>
                <li><a href="../tutorials.html">Tutorials</a></li>
                <li><a href="../auto_examples/index.html">Gallery</a></li>
                <li><a href="../python_reference.html">API</a></li>
                <li><a href="../manual/index.html">Manual</a></li>
                <li><a href="../faq.html">FAQ</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../auto_examples/index.html">Examples Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contribute to MNE</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../python_reference.html">Python API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../manual/index.html">User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whats_new.html">What&#8217;s new</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cite.html">How to cite MNE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">Related publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cited.html">Publications from MNE users</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Permutation t-test on toy data with spatial clustering</a><ul>
<li><a class="reference internal" href="#set-parameters">Set parameters</a></li>
<li><a class="reference internal" href="#construct-simulated-data">Construct simulated data</a></li>
<li><a class="reference internal" href="#do-some-statistics">Do some statistics</a></li>
<li><a class="reference internal" href="#visualize-results">Visualize results</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/mne_logo_small.png" alt="Logo"/>
            </a></p><ul>
<li><a class="reference internal" href="#">Permutation t-test on toy data with spatial clustering</a><ul>
<li><a class="reference internal" href="#set-parameters">Set parameters</a></li>
<li><a class="reference internal" href="#construct-simulated-data">Construct simulated data</a></li>
<li><a class="reference internal" href="#do-some-statistics">Do some statistics</a></li>
<li><a class="reference internal" href="#visualize-results">Visualize results</a></li>
</ul>
</li>
</ul>

  <li>
    <a href="plot_brainstorm_auditory.html" title="Previous Chapter: Brainstorm auditory tutorial dataset"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Brainstorm au...</span>
    </a>
  </li>
  <li>
    <a href="plot_stats_spatio_temporal_cluster_sensors.html" title="Next Chapter: Spatiotemporal permutation F-test on full sensor data"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Spatiotempora... &raquo;</span>
    </a>
  </li>
<form action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="col-md-12">
      
  <div class="section" id="permutation-t-test-on-toy-data-with-spatial-clustering">
<span id="tut-stats-cluster-methods"></span><span id="sphx-glr-auto-tutorials-plot-stats-cluster-methods-py"></span><h1>Permutation t-test on toy data with spatial clustering<a class="headerlink" href="#permutation-t-test-on-toy-data-with-spatial-clustering" title="Permalink to this headline">Â¶</a></h1>
<p>Following the illustrative example of Ridgway et al. 2012,
this demonstrates some basic ideas behind both the &#8220;hat&#8221;
variance adjustment method, as well as threshold-free
cluster enhancement (TFCE) methods in mne-python.</p>
<p>This toy dataset consists of a 40 x 40 square with a &#8220;signal&#8221;
present in the center (at pixel [20, 20]) with white noise
added and a 5-pixel-SD normal smoothing kernel applied.</p>
<p>For more information, see:
Ridgway et al. 2012, &#8220;The problem of low variance voxels in
statistical parametric mapping; a new hat avoids a &#8216;haircut&#8217;&#8221;,
NeuroImage. 2012 Feb 1;59(3):2131-41.</p>
<p>Smith and Nichols 2009, &#8220;Threshold-free cluster enhancement:
addressing problems of smoothing, threshold dependence, and
localisation in cluster inference&#8221;, NeuroImage 44 (2009) 83-98.</p>
<p>In the top row plot the T statistic over space, peaking toward the
center. Note that it has peaky edges. Second, with the &#8220;hat&#8221; variance
correction/regularization, the peak becomes correctly centered. Third,
the TFCE approach also corrects for these edge artifacts. Fourth, the
the two methods combined provide a tighter estimate, for better or
worse.</p>
<p>Now considering multiple-comparisons corrected statistics on these
variables, note that a non-cluster test (e.g., FDR or Bonferroni) would
mis-localize the peak due to sharpness in the T statistic driven by
low-variance pixels toward the edge of the plateau. Standard clustering
(first plot in the second row) identifies the correct region, but the
whole area must be declared significant, so no peak analysis can be done.
Also, the peak is broad. In this method, all significances are
family-wise error rate (FWER) corrected, and the method is
non-parametric so assumptions of Gaussian data distributions (which do
actually hold for this example) don&#8217;t need to be satisfied. Adding the
&#8220;hat&#8221; technique tightens the estimate of significant activity (second
plot). The TFCE approach (third plot) allows analyzing each significant
point independently, but still has a broadened estimate. Note that
this is also FWER corrected. Finally, combining the TFCE and &#8220;hat&#8221;
methods tightens the area declared significant (again FWER corrected),
and allows for evaluation of each point independently instead of as
a single, broad cluster.</p>
<p>Note that this example does quite a bit of processing, so even on a
fast machine it can take a few minutes to complete.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c1"># Authors: Eric Larson &lt;larson.eric.d@gmail.com&gt;</span>
<span class="c1"># License: BSD (3-clause)</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>  <span class="c1"># noqa; this changes hidden mpl vars</span>

<span class="kn">from</span> <span class="nn">mne.stats</span> <span class="kn">import</span> <span class="p">(</span><a href="../generated/mne.stats.spatio_temporal_cluster_1samp_test.html#mne.stats.spatio_temporal_cluster_1samp_test"><span class="n">spatio_temporal_cluster_1samp_test</span></a><span class="p">,</span>
                       <a href="../generated/mne.stats.bonferroni_correction.html#mne.stats.bonferroni_correction"><span class="n">bonferroni_correction</span></a><span class="p">,</span> <a href="../generated/mne.stats.ttest_1samp_no_p.html#mne.stats.ttest_1samp_no_p"><span class="n">ttest_1samp_no_p</span></a><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">sklearn.feature_extraction.image</span> <span class="kn">import</span> <span class="n">grid_to_graph</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">scikits.learn.feature_extraction.image</span> <span class="kn">import</span> <span class="n">grid_to_graph</span>

<span class="k">print</span><span class="p">(</span><span class="n">__doc__</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="set-parameters">
<h2>Set parameters<a class="headerlink" href="#set-parameters" title="Permalink to this headline">Â¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="n">width</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">n_subjects</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">signal_mean</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">signal_sd</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">noise_sd</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">gaussian_sd</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">1e-3</span>  <span class="c1"># sigma for the &quot;hat&quot; method</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="o">-</span><span class="n">stats</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">n_subjects</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">threshold_tfce</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">n_permutations</span> <span class="o">=</span> <span class="mi">1024</span>  <span class="c1"># number of clustering permutations (1024 for exact)</span>
</pre></div>
</div>
</div>
<div class="section" id="construct-simulated-data">
<h2>Construct simulated data<a class="headerlink" href="#construct-simulated-data" title="Permalink to this headline">Â¶</a></h2>
<p>Make the connectivity matrix just next-neighbor spatially</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">n_src</span> <span class="o">=</span> <span class="n">width</span> <span class="o">*</span> <span class="n">width</span>
<span class="n">connectivity</span> <span class="o">=</span> <span class="n">grid_to_graph</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>

<span class="c1">#    For each &quot;subject&quot;, make a smoothed noisy signal with a centered peak</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">noise_sd</span> <span class="o">*</span> <span class="n">rng</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n_subjects</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
<span class="c1">#    Add a signal at the dead center</span>
<span class="n">X</span><span class="p">[:,</span> <span class="n">width</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">width</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">signal_mean</span> <span class="o">+</span> <span class="n">rng</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n_subjects</span><span class="p">)</span> <span class="o">*</span> <span class="n">signal_sd</span>
<span class="c1">#    Spatially smooth with a 2D Gaussian kernel</span>
<span class="n">size</span> <span class="o">=</span> <span class="n">width</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">gaussian</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.10.1/reference/generated/numpy.exp.html#numpy.exp"><span class="n">np</span><span class="o">.</span><span class="n">exp</span></a><span class="p">(</span><span class="o">-</span><span class="p">(</span><a href="http://docs.scipy.org/doc/numpy-1.10.1/reference/generated/numpy.arange.html#numpy.arange"><span class="n">np</span><span class="o">.</span><span class="n">arange</span></a><span class="p">(</span><span class="o">-</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">gaussian_sd</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span>
<span class="k">for</span> <span class="n">si</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="k">for</span> <span class="n">ri</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">X</span><span class="p">[</span><span class="n">si</span><span class="p">,</span> <span class="n">ri</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.10.1/reference/generated/numpy.convolve.html#numpy.convolve"><span class="n">np</span><span class="o">.</span><span class="n">convolve</span></a><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">si</span><span class="p">,</span> <span class="n">ri</span><span class="p">,</span> <span class="p">:],</span> <span class="n">gaussian</span><span class="p">,</span> <span class="s1">&#39;same&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ci</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
        <span class="n">X</span><span class="p">[</span><span class="n">si</span><span class="p">,</span> <span class="p">:,</span> <span class="n">ci</span><span class="p">]</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.10.1/reference/generated/numpy.convolve.html#numpy.convolve"><span class="n">np</span><span class="o">.</span><span class="n">convolve</span></a><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">si</span><span class="p">,</span> <span class="p">:,</span> <span class="n">ci</span><span class="p">],</span> <span class="n">gaussian</span><span class="p">,</span> <span class="s1">&#39;same&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="do-some-statistics">
<h2>Do some statistics<a class="headerlink" href="#do-some-statistics" title="Permalink to this headline">Â¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">X needs to be a multi-dimensional array of shape
samples (subjects) x time x space, so we permute dimensions:</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">n_subjects</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_src</span><span class="p">))</span>
</pre></div>
</div>
<p>Now let&#8217;s do some clustering using the standard method.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Not specifying a connectivity matrix implies grid-like connectivity,
which we want here:</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">T_obs</span><span class="p">,</span> <span class="n">clusters</span><span class="p">,</span> <span class="n">p_values</span><span class="p">,</span> <span class="n">H0</span> <span class="o">=</span> \
    <a href="../generated/mne.stats.spatio_temporal_cluster_1samp_test.html#mne.stats.spatio_temporal_cluster_1samp_test"><span class="n">spatio_temporal_cluster_1samp_test</span></a><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
                                       <span class="n">connectivity</span><span class="o">=</span><span class="n">connectivity</span><span class="p">,</span>
                                       <span class="n">tail</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_permutations</span><span class="o">=</span><span class="n">n_permutations</span><span class="p">)</span>

<span class="c1">#    Let&#39;s put the cluster data in a readable format</span>
<span class="n">ps</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.10.1/reference/generated/numpy.zeros.html#numpy.zeros"><span class="n">np</span><span class="o">.</span><span class="n">zeros</span></a><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>
<span class="k">for</span> <span class="n">cl</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">clusters</span><span class="p">,</span> <span class="n">p_values</span><span class="p">):</span>
    <span class="n">ps</span><span class="p">[</span><span class="n">cl</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="o">-</span><a href="http://docs.scipy.org/doc/numpy-1.10.1/reference/generated/numpy.log10.html#numpy.log10"><span class="n">np</span><span class="o">.</span><span class="n">log10</span></a><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="n">ps</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">width</span><span class="p">,</span> <span class="n">width</span><span class="p">))</span>
<span class="n">T_obs</span> <span class="o">=</span> <span class="n">T_obs</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">width</span><span class="p">,</span> <span class="n">width</span><span class="p">))</span>

<span class="c1">#     To do a Bonferroni correction on these data is simple:</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">T_obs</span><span class="p">,</span> <span class="n">n_subjects</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p_bon</span> <span class="o">=</span> <span class="o">-</span><a href="http://docs.scipy.org/doc/numpy-1.10.1/reference/generated/numpy.log10.html#numpy.log10"><span class="n">np</span><span class="o">.</span><span class="n">log10</span></a><span class="p">(</span><a href="../generated/mne.stats.bonferroni_correction.html#mne.stats.bonferroni_correction"><span class="n">bonferroni_correction</span></a><span class="p">(</span><span class="n">p</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1">#    Now let&#39;s do some clustering using the standard method with &quot;hat&quot;:</span>
<span class="n">stat_fun</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><a href="../generated/mne.stats.ttest_1samp_no_p.html#mne.stats.ttest_1samp_no_p"><span class="n">ttest_1samp_no_p</span></a><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">)</span>
<span class="n">T_obs_hat</span><span class="p">,</span> <span class="n">clusters</span><span class="p">,</span> <span class="n">p_values</span><span class="p">,</span> <span class="n">H0</span> <span class="o">=</span> \
    <a href="../generated/mne.stats.spatio_temporal_cluster_1samp_test.html#mne.stats.spatio_temporal_cluster_1samp_test"><span class="n">spatio_temporal_cluster_1samp_test</span></a><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
                                       <span class="n">connectivity</span><span class="o">=</span><span class="n">connectivity</span><span class="p">,</span>
                                       <span class="n">tail</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_permutations</span><span class="o">=</span><span class="n">n_permutations</span><span class="p">,</span>
                                       <span class="n">stat_fun</span><span class="o">=</span><span class="n">stat_fun</span><span class="p">)</span>

<span class="c1">#    Let&#39;s put the cluster data in a readable format</span>
<span class="n">ps_hat</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.10.1/reference/generated/numpy.zeros.html#numpy.zeros"><span class="n">np</span><span class="o">.</span><span class="n">zeros</span></a><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>
<span class="k">for</span> <span class="n">cl</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">clusters</span><span class="p">,</span> <span class="n">p_values</span><span class="p">):</span>
    <span class="n">ps_hat</span><span class="p">[</span><span class="n">cl</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="o">-</span><a href="http://docs.scipy.org/doc/numpy-1.10.1/reference/generated/numpy.log10.html#numpy.log10"><span class="n">np</span><span class="o">.</span><span class="n">log10</span></a><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="n">ps_hat</span> <span class="o">=</span> <span class="n">ps_hat</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">width</span><span class="p">,</span> <span class="n">width</span><span class="p">))</span>
<span class="n">T_obs_hat</span> <span class="o">=</span> <span class="n">T_obs_hat</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">width</span><span class="p">,</span> <span class="n">width</span><span class="p">))</span>

<span class="c1">#    Now the threshold-free cluster enhancement method (TFCE):</span>
<span class="n">T_obs_tfce</span><span class="p">,</span> <span class="n">clusters</span><span class="p">,</span> <span class="n">p_values</span><span class="p">,</span> <span class="n">H0</span> <span class="o">=</span> \
    <a href="../generated/mne.stats.spatio_temporal_cluster_1samp_test.html#mne.stats.spatio_temporal_cluster_1samp_test"><span class="n">spatio_temporal_cluster_1samp_test</span></a><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold_tfce</span><span class="p">,</span>
                                       <span class="n">connectivity</span><span class="o">=</span><span class="n">connectivity</span><span class="p">,</span>
                                       <span class="n">tail</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_permutations</span><span class="o">=</span><span class="n">n_permutations</span><span class="p">)</span>
<span class="n">T_obs_tfce</span> <span class="o">=</span> <span class="n">T_obs_tfce</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">width</span><span class="p">,</span> <span class="n">width</span><span class="p">))</span>
<span class="n">ps_tfce</span> <span class="o">=</span> <span class="o">-</span><a href="http://docs.scipy.org/doc/numpy-1.10.1/reference/generated/numpy.log10.html#numpy.log10"><span class="n">np</span><span class="o">.</span><span class="n">log10</span></a><span class="p">(</span><span class="n">p_values</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">width</span><span class="p">,</span> <span class="n">width</span><span class="p">)))</span>

<span class="c1">#    Now the TFCE with &quot;hat&quot; variance correction:</span>
<span class="n">T_obs_tfce_hat</span><span class="p">,</span> <span class="n">clusters</span><span class="p">,</span> <span class="n">p_values</span><span class="p">,</span> <span class="n">H0</span> <span class="o">=</span> \
    <a href="../generated/mne.stats.spatio_temporal_cluster_1samp_test.html#mne.stats.spatio_temporal_cluster_1samp_test"><span class="n">spatio_temporal_cluster_1samp_test</span></a><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold_tfce</span><span class="p">,</span>
                                       <span class="n">connectivity</span><span class="o">=</span><span class="n">connectivity</span><span class="p">,</span>
                                       <span class="n">tail</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_permutations</span><span class="o">=</span><span class="n">n_permutations</span><span class="p">,</span>
                                       <span class="n">stat_fun</span><span class="o">=</span><span class="n">stat_fun</span><span class="p">)</span>
<span class="n">T_obs_tfce_hat</span> <span class="o">=</span> <span class="n">T_obs_tfce_hat</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">width</span><span class="p">,</span> <span class="n">width</span><span class="p">))</span>
<span class="n">ps_tfce_hat</span> <span class="o">=</span> <span class="o">-</span><a href="http://docs.scipy.org/doc/numpy-1.10.1/reference/generated/numpy.log10.html#numpy.log10"><span class="n">np</span><span class="o">.</span><span class="n">log10</span></a><span class="p">(</span><span class="n">p_values</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">width</span><span class="p">,</span> <span class="n">width</span><span class="p">)))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-python"><div class="highlight"><pre>stat_fun(H1): min=-2.676791 max=5.182156
Running initial clustering
Found 1 clusters
Permuting ...

[                                        ] 0.09775 |
[.                                       ] 3.12805 /
[..                                      ] 6.25611 -
[...                                     ] 9.38416 \
[.....                                   ] 12.51222 |
[......                                  ] 15.64027 /
[.......                                 ] 18.76833 -
[........                                ] 21.89638 \
[..........                              ] 25.02444 |
[...........                             ] 28.15249 /
[............                            ] 31.28055 -
[.............                           ] 34.40860 \
[...............                         ] 37.53666 |
[................                        ] 40.66471 /
[.................                       ] 43.79277 -
[..................                      ] 46.92082 \
[....................                    ] 50.04888 |
[.....................                   ] 53.17693 /
[......................                  ] 56.30499 -
[.......................                 ] 59.43304 \
[.........................               ] 62.56109 |
[..........................              ] 65.68915 /
[...........................             ] 68.81720 -
[............................            ] 71.94526 \
[..............................          ] 75.07331 |
[...............................         ] 78.20137 /
[................................        ] 81.32942 -
[.................................       ] 84.45748 \
[...................................     ] 87.58553 |
[....................................    ] 90.71359 /
[.....................................   ] 93.84164 -
[......................................  ] 96.96970 \    Computing cluster p-values
Done.
stat_fun(H1): min=-0.044294 max=4.600984
Provided stat_fun does not treat variables independently. Setting buffer_size to None.
Running initial clustering
Found 1 clusters
Permuting ...

[                                        ] 0.09775 |
[.                                       ] 3.12805 /
[..                                      ] 6.25611 -
[...                                     ] 9.38416 \
[.....                                   ] 12.51222 |
[......                                  ] 15.64027 /
[.......                                 ] 18.76833 -
[........                                ] 21.89638 \
[..........                              ] 25.02444 |
[...........                             ] 28.15249 /
[............                            ] 31.28055 -
[.............                           ] 34.40860 \
[...............                         ] 37.53666 |
[................                        ] 40.66471 /
[.................                       ] 43.79277 -
[..................                      ] 46.92082 \
[....................                    ] 50.04888 |
[.....................                   ] 53.17693 /
[......................                  ] 56.30499 -
[.......................                 ] 59.43304 \
[.........................               ] 62.56109 |
[..........................              ] 65.68915 /
[...........................             ] 68.81720 -
[............................            ] 71.94526 \
[..............................          ] 75.07331 |
[...............................         ] 78.20137 /
[................................        ] 81.32942 -
[.................................       ] 84.45748 \
[...................................     ] 87.58553 |
[....................................    ] 90.71359 /
[.....................................   ] 93.84164 -
[......................................  ] 96.96970 \    Computing cluster p-values
Done.
stat_fun(H1): min=-2.676791 max=5.182156
Running initial clustering
Using 26 thresholds from 0.00 to 5.00 for TFCE computation (h_power=2.00, e_power=0.50)
Found 1600 clusters
Permuting ...

[                                        ] 0.09775 |
[.                                       ] 3.12805 /
[..                                      ] 6.25611 -
[...                                     ] 9.38416 \
[.....                                   ] 12.51222 |
[......                                  ] 15.64027 /
[.......                                 ] 18.76833 -
[........                                ] 21.89638 \
[..........                              ] 25.02444 |
[...........                             ] 28.15249 /
[............                            ] 31.28055 -
[.............                           ] 34.40860 \
[...............                         ] 37.53666 |
[................                        ] 40.66471 /
[.................                       ] 43.79277 -
[..................                      ] 46.92082 \
[....................                    ] 50.04888 |
[.....................                   ] 53.17693 /
[......................                  ] 56.30499 -
[.......................                 ] 59.43304 \
[.........................               ] 62.56109 |
[..........................              ] 65.68915 /
[...........................             ] 68.81720 -
[............................            ] 71.94526 \
[..............................          ] 75.07331 |
[...............................         ] 78.20137 /
[................................        ] 81.32942 -
[.................................       ] 84.45748 \
[...................................     ] 87.58553 |
[....................................    ] 90.71359 /
[.....................................   ] 93.84164 -
[......................................  ] 96.96970 \    Computing cluster p-values
Done.
stat_fun(H1): min=-0.044294 max=4.600984
Provided stat_fun does not treat variables independently. Setting buffer_size to None.
Running initial clustering
Using 24 thresholds from 0.00 to 4.60 for TFCE computation (h_power=2.00, e_power=0.50)
Found 1600 clusters
Permuting ...

[                                        ] 0.09775 |
[.                                       ] 3.12805 /
[..                                      ] 6.25611 -
[...                                     ] 9.38416 \
[.....                                   ] 12.51222 |
[......                                  ] 15.64027 /
[.......                                 ] 18.76833 -
[........                                ] 21.89638 \
[..........                              ] 25.02444 |
[...........                             ] 28.15249 /
[............                            ] 31.28055 -
[.............                           ] 34.40860 \
[...............                         ] 37.53666 |
[................                        ] 40.66471 /
[.................                       ] 43.79277 -
[..................                      ] 46.92082 \
[....................                    ] 50.04888 |
[.....................                   ] 53.17693 /
[......................                  ] 56.30499 -
[.......................                 ] 59.43304 \
[.........................               ] 62.56109 |
[..........................              ] 65.68915 /
[...........................             ] 68.81720 -
[............................            ] 71.94526 \
[..............................          ] 75.07331 |
[...............................         ] 78.20137 /
[................................        ] 81.32942 -
[.................................       ] 84.45748 \
[...................................     ] 87.58553 |
[....................................    ] 90.71359 /
[.....................................   ] 93.84164 -
[......................................  ] 96.96970 \    Computing cluster p-values
Done.
</pre></div>
</div>
</div>
<div class="section" id="visualize-results">
<h2>Visualize results<a class="headerlink" href="#visualize-results" title="Permalink to this headline">Â¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fig</span> <span class="o">=</span> <a href="http://matplotlib.org/api/figure_api.html#matplotlib.figure"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span></a><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>

<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.10.1/reference/generated/numpy.mgrid.html#numpy.mgrid"><span class="n">np</span><span class="o">.</span><span class="n">mgrid</span></a><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">width</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">width</span><span class="p">]</span>
<span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greens&#39;</span><span class="p">)</span>

<span class="n">Ts</span> <span class="o">=</span> <span class="p">[</span><span class="n">T_obs</span><span class="p">,</span> <span class="n">T_obs_hat</span><span class="p">,</span> <span class="n">T_obs_tfce</span><span class="p">,</span> <span class="n">T_obs_tfce_hat</span><span class="p">]</span>
<span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;T statistic&#39;</span><span class="p">,</span> <span class="s1">&#39;T with &quot;hat&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;TFCE statistic&#39;</span><span class="p">,</span> <span class="s1">&#39;TFCE w/&quot;hat&quot; stat&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">Ts</span><span class="p">,</span> <span class="n">titles</span><span class="p">)):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

<span class="n">p_lims</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.3</span><span class="p">,</span> <span class="o">-</span><a href="http://docs.scipy.org/doc/numpy-1.10.1/reference/generated/numpy.log10.html#numpy.log10"><span class="n">np</span><span class="o">.</span><span class="n">log10</span></a><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">n_permutations</span><span class="p">)]</span>
<span class="n">pvals</span> <span class="o">=</span> <span class="p">[</span><span class="n">ps</span><span class="p">,</span> <span class="n">ps_hat</span><span class="p">,</span> <span class="n">ps_tfce</span><span class="p">,</span> <span class="n">ps_tfce_hat</span><span class="p">]</span>
<span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Standard clustering&#39;</span><span class="p">,</span> <span class="s1">&#39;Clust. w/&quot;hat&quot;&#39;</span><span class="p">,</span>
          <span class="s1">&#39;Clust. w/TFCE&#39;</span><span class="p">,</span> <span class="s1">&#39;Clust. w/TFCE+&quot;hat&quot;&#39;</span><span class="p">]</span>
<span class="n">axs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">pvals</span><span class="p">,</span> <span class="n">titles</span><span class="p">)):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">ii</span><span class="p">)</span>
    <a href="http://matplotlib.org/api/pyplot_api.html#matplotlib.pyplot.imshow"><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span></a><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Purples&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">p_lims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmax</span><span class="o">=</span><span class="n">p_lims</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

<a href="http://matplotlib.org/api/tight_layout_api.html#matplotlib.tight_layout"><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span></a><span class="p">()</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">:</span>
    <span class="n">cbar</span> <span class="o">=</span> <a href="http://matplotlib.org/api/colorbar_api.html#matplotlib.colorbar"><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span></a><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span>
                        <span class="n">fraction</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.025</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;-log10(p)&#39;</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">p_lims</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%0.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">p_lims</span><span class="p">])</span>

<a href="http://matplotlib.org/api/pyplot_api.html#matplotlib.pyplot.show"><span class="n">plt</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_stats_cluster_methods_001.png" class="align-center" src="../_images/sphx_glr_plot_stats_cluster_methods_001.png" />
<p><strong>Total running time of the script:</strong>
(1 minutes 39.583 seconds)</p>
<div class="sphx-glr-download container">
<strong>Download Python source code:</strong> <a class="reference download internal" href="../_downloads/plot_stats_cluster_methods.py"><tt class="xref download docutils literal"><span class="pre">plot_stats_cluster_methods.py</span></tt></a></div>
<div class="sphx-glr-download container">
<strong>Download IPython notebook:</strong> <a class="reference download internal" href="../_downloads/plot_stats_cluster_methods.ipynb"><tt class="xref download docutils literal"><span class="pre">plot_stats_cluster_methods.ipynb</span></tt></a></div>
</div>
</div>


    </div>
    
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright 2012-2016, MNE Developers. Last updated on 2016-05-11.<br/>
    </p>
  </div>
</footer>
  </body>
</html>