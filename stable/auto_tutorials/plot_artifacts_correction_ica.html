<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Artifact Correction with ICA &mdash; MNE 0.12.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.3.4/flatly/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.12.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="MNE 0.12.0 documentation" href="../index.html" />
    <link rel="up" title="Tutorials" href="../tutorials.html" />
    <link rel="next" title="Artifact correction with Maxwell filter" href="plot_artifacts_correction_maxwell_filtering.html" />
    <link rel="prev" title="Artifact Correction with SSP" href="plot_artifacts_correction_ssp.html" />

<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700' rel='stylesheet' type='text/css'>


    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37225609-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>



    <script type="text/javascript">
    !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);
    js.id=id;js.src="http://platform.twitter.com/widgets.js";
    fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
    </script>



    <script type="text/javascript">
    (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
    </script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><img src="../_static/mne_logo_small.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>0.12.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../getting_started.html">Get started</a></li>
                <li><a href="../tutorials.html">Tutorials</a></li>
                <li><a href="../auto_examples/index.html">Gallery</a></li>
                <li><a href="../python_reference.html">API</a></li>
                <li><a href="../manual/index.html">Manual</a></li>
                <li><a href="../faq.html">FAQ</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../auto_examples/index.html">Examples Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contribute to MNE</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../python_reference.html">Python API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../manual/index.html">User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whats_new.html">What&#8217;s new</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cite.html">How to cite MNE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">Related publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cited.html">Publications from MNE users</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Artifact Correction with ICA</a><ul>
<li><a class="reference internal" href="#fit-ica">Fit ICA</a></li>
<li><a class="reference internal" href="#advanced-artifact-detection">Advanced artifact detection</a></li>
<li><a class="reference internal" href="#what-if-we-don-t-have-an-eog-channel">What if we don&#8217;t have an EOG channel?</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/mne_logo_small.png" alt="Logo"/>
            </a></p><ul>
<li><a class="reference internal" href="#">Artifact Correction with ICA</a><ul>
<li><a class="reference internal" href="#fit-ica">Fit ICA</a></li>
<li><a class="reference internal" href="#advanced-artifact-detection">Advanced artifact detection</a></li>
<li><a class="reference internal" href="#what-if-we-don-t-have-an-eog-channel">What if we don&#8217;t have an EOG channel?</a></li>
</ul>
</li>
</ul>

  <li>
    <a href="plot_artifacts_correction_ssp.html" title="Previous Chapter: Artifact Correction with SSP"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Artifact Corr...</span>
    </a>
  </li>
  <li>
    <a href="plot_artifacts_correction_maxwell_filtering.html" title="Next Chapter: Artifact correction with Maxwell filter"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Artifact corr... &raquo;</span>
    </a>
  </li>
<form action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="col-md-12">
      
  <div class="section" id="artifact-correction-with-ica">
<span id="tut-artifacts-correct-ica"></span><span id="sphx-glr-auto-tutorials-plot-artifacts-correction-ica-py"></span><h1>Artifact Correction with ICA<a class="headerlink" href="#artifact-correction-with-ica" title="Permalink to this headline">Â¶</a></h1>
<p>ICA finds directions in the feature space
corresponding to projections with high non-Gaussianity. We thus obtain
a decomposition into independent components, and the artifact&#8217;s contribution
is localized in only a small number of components.
These components have to be correctly identified and removed.</p>
<p>If EOG or ECG recordings are available, they can be used in ICA to
automatically select the corresponding artifact components from the
decomposition. To do so, you have to first build an Epoch object around
blink or heartbeat event.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">mne</span>
<span class="kn">from</span> <span class="nn">mne.datasets</span> <span class="kn">import</span> <span class="n">sample</span>

<span class="kn">from</span> <span class="nn">mne.preprocessing</span> <span class="kn">import</span> <a href="../generated/mne.preprocessing.ICA.html#mne.preprocessing.ICA"><span class="n">ICA</span></a>
<span class="kn">from</span> <span class="nn">mne.preprocessing</span> <span class="kn">import</span> <a href="../generated/mne.preprocessing.create_eog_epochs.html#mne.preprocessing.create_eog_epochs"><span class="n">create_eog_epochs</span></a>

<span class="c1"># getting some data ready</span>
<span class="n">data_path</span> <span class="o">=</span> <a href="../generated/mne.datasets.sample.data_path.html#mne.datasets.sample.data_path"><span class="n">sample</span><span class="o">.</span><span class="n">data_path</span></a><span class="p">()</span>
<span class="n">raw_fname</span> <span class="o">=</span> <span class="n">data_path</span> <span class="o">+</span> <span class="s1">&#39;/MEG/sample/sample_audvis_filt-0-40_raw.fif&#39;</span>

<span class="n">raw</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_raw_fif</span><span class="p">(</span><span class="n">raw_fname</span><span class="p">,</span> <span class="n">preload</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">raw</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># 1Hz high pass is often helpful for fitting ICA</span>

<span class="n">picks_meg</span> <span class="o">=</span> <a href="../generated/mne.pick_types.html#mne.pick_types"><span class="n">mne</span><span class="o">.</span><span class="n">pick_types</span></a><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">,</span> <span class="n">meg</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">eeg</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">eog</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                           <span class="n">stim</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="s1">&#39;bads&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Before applying artifact correction please learn about your actual artifacts
by reading <a class="reference internal" href="plot_artifacts_detection.html#tut-artifacts-detect"><em>Introduction to artifacts and artifact detection</em></a>.</p>
<div class="section" id="fit-ica">
<h2>Fit ICA<a class="headerlink" href="#fit-ica" title="Permalink to this headline">Â¶</a></h2>
<p>ICA parameters:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">n_components</span> <span class="o">=</span> <span class="mi">25</span>  <span class="c1"># if float, select n_components by explained variance of PCA</span>
<span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;fastica&#39;</span>  <span class="c1"># for comparison with EEGLAB try &quot;extended-infomax&quot; here</span>
<span class="n">decim</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># we need sufficient statistics, not all time points -&gt; save time</span>
</pre></div>
</div>
<p>Define the ICA object instance</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ica</span> <span class="o">=</span> <a href="../generated/mne.preprocessing.ICA.html#mne.preprocessing.ICA"><span class="n">ICA</span></a><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">ica</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-python"><div class="highlight"><pre>&lt;ICA  |  no decomposition, fit (fastica):  samples, no dimension reduction&gt;
</pre></div>
</div>
<p>we avoid fitting ICA on crazy environmental artifacts that would
dominate the variance and decomposition</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">reject</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">mag</span><span class="o">=</span><span class="mf">5e-12</span><span class="p">,</span> <span class="n">grad</span><span class="o">=</span><span class="mf">4000e-13</span><span class="p">)</span>
<span class="n">ica</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">picks</span><span class="o">=</span><span class="n">picks_meg</span><span class="p">,</span> <span class="n">decim</span><span class="o">=</span><span class="n">decim</span><span class="p">,</span> <span class="n">reject</span><span class="o">=</span><span class="n">reject</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">ica</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-python"><div class="highlight"><pre>&lt;ICA  |  raw data decomposition, fit (fastica): 13635 samples, 25 components, channels used: &quot;mag&quot;; &quot;grad&quot;&gt;
</pre></div>
</div>
<p>Plot ICA components</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ica</span><span class="o">.</span><span class="n">plot_components</span><span class="p">()</span>  <span class="c1"># can you see some potential bad guys?</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><a class="first reference internal image-reference" href="../_images/sphx_glr_plot_artifacts_correction_ica_001.png"><img alt="../_images/sphx_glr_plot_artifacts_correction_ica_001.png" src="../_images/sphx_glr_plot_artifacts_correction_ica_001.png" style="width: 347.8px; height: 329.0px;" /></a>
</li>
<li><a class="first reference internal image-reference" href="../_images/sphx_glr_plot_artifacts_correction_ica_002.png"><img alt="../_images/sphx_glr_plot_artifacts_correction_ica_002.png" src="../_images/sphx_glr_plot_artifacts_correction_ica_002.png" style="width: 347.8px; height: 117.5px;" /></a>
</li>
</ul>
</div>
<div class="section" id="advanced-artifact-detection">
<h2>Advanced artifact detection<a class="headerlink" href="#advanced-artifact-detection" title="Permalink to this headline">Â¶</a></h2>
<p>Let&#8217;s use a more efficient way to find artefacts</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">eog_average</span> <span class="o">=</span> <a href="../generated/mne.preprocessing.create_eog_epochs.html#mne.preprocessing.create_eog_epochs"><span class="n">create_eog_epochs</span></a><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">reject</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mag</span><span class="o">=</span><span class="mf">5e-12</span><span class="p">,</span> <span class="n">grad</span><span class="o">=</span><span class="mf">4000e-13</span><span class="p">),</span>
                                <span class="n">picks</span><span class="o">=</span><span class="n">picks_meg</span><span class="p">)</span><span class="o">.</span><span class="n">average</span><span class="p">()</span>

<span class="c1"># We simplify things by setting the maximum number of components to reject</span>
<span class="n">n_max_eog</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># here we bet on finding the vertical EOG components</span>
<span class="n">eog_epochs</span> <span class="o">=</span> <a href="../generated/mne.preprocessing.create_eog_epochs.html#mne.preprocessing.create_eog_epochs"><span class="n">create_eog_epochs</span></a><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">reject</span><span class="o">=</span><span class="n">reject</span><span class="p">)</span>  <span class="c1"># get single EOG trials</span>
<span class="n">eog_inds</span><span class="p">,</span> <span class="n">scores</span> <span class="o">=</span> <span class="n">ica</span><span class="o">.</span><span class="n">find_bads_eog</span><span class="p">(</span><span class="n">eog_epochs</span><span class="p">)</span>  <span class="c1"># find via correlation</span>

<span class="n">ica</span><span class="o">.</span><span class="n">plot_scores</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">eog_inds</span><span class="p">)</span>  <span class="c1"># look at r scores of components</span>
<span class="c1"># we can see that only one component is highly correlated and that this</span>
<span class="c1"># component got detected by our correlation analysis (red).</span>

<span class="n">ica</span><span class="o">.</span><span class="n">plot_sources</span><span class="p">(</span><span class="n">eog_average</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">eog_inds</span><span class="p">)</span>  <span class="c1"># look at source time course</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><a class="first reference internal image-reference" href="../_images/sphx_glr_plot_artifacts_correction_ica_003.png"><img alt="../_images/sphx_glr_plot_artifacts_correction_ica_003.png" src="../_images/sphx_glr_plot_artifacts_correction_ica_003.png" style="width: 564.0px; height: 282.0px;" /></a>
</li>
<li><a class="first reference internal image-reference" href="../_images/sphx_glr_plot_artifacts_correction_ica_004.png"><img alt="../_images/sphx_glr_plot_artifacts_correction_ica_004.png" src="../_images/sphx_glr_plot_artifacts_correction_ica_004.png" style="width: 376.0px; height: 282.0px;" /></a>
</li>
</ul>
<p>That component is also showing a prototypical average vertical EOG time
course.</p>
<p>Pay attention to the labels, a customized read-out of the <a href="#id1"><span class="problematic" id="id2">ica.labels_</span></a></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span><span class="p">(</span><span class="n">ica</span><span class="o">.</span><span class="n">labels_</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s1">u&#39;eog/0/EOG 061&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="s1">&#39;eog&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">12</span><span class="p">]}</span>
</pre></div>
</div>
<p>These labels were used by the plotters and are added automatically
by artifact detection functions. You can also manually edit them to annotate
components.</p>
<p>Now let&#8217;s see how we would modify our signals if we would remove this
component from the data</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ica</span><span class="o">.</span><span class="n">plot_overlay</span><span class="p">(</span><span class="n">eog_average</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">eog_inds</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="c1"># red -&gt; before, black -&gt; after. Yes! We remove quite a lot!</span>

<span class="c1"># to definitely register this component as a bad one to be removed</span>
<span class="c1"># there is the ``ica.exclude`` attribute, a simple Python list</span>

<span class="n">ica</span><span class="o">.</span><span class="n">exclude</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">eog_inds</span><span class="p">)</span>

<span class="c1"># from now on the ICA will reject this component even if no exclude</span>
<span class="c1"># parameter is passed, and this information will be stored to disk</span>
<span class="c1"># on saving</span>

<span class="c1"># uncomment this for reading and writing</span>
<span class="c1"># ica.save(&#39;my-ica.fif&#39;)</span>
<span class="c1"># ica = read_ica(&#39;my-ica.fif&#39;)</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_artifacts_correction_ica_005.png" class="align-center" src="../_images/sphx_glr_plot_artifacts_correction_ica_005.png" />
<p>Exercise: find and remove ECG artifacts using ICA!</p>
</div>
<div class="section" id="what-if-we-don-t-have-an-eog-channel">
<h2>What if we don&#8217;t have an EOG channel?<a class="headerlink" href="#what-if-we-don-t-have-an-eog-channel" title="Permalink to this headline">Â¶</a></h2>
<p>1) make a bipolar reference from frontal EEG sensors and use as virtual EOG
channel. This can be tricky though as you can only hope that the frontal
EEG channels only reflect EOG and not brain dynamics in the prefrontal
cortex.
2) Go for a semi-automated approach, using template matching.
In MNE-Python option 2 is easily achievable and it might be better,
so let&#8217;s have a look at it.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">mne.preprocessing.ica</span> <span class="kn">import</span> <span class="n">corrmap</span>  <span class="c1"># noqa</span>
</pre></div>
</div>
<p>The idea behind corrmap is that artefact patterns are similar across subjects
and can thus be identified by correlating the different patterns resulting
from each solution with a template. The procedure is therefore
semi-automatic. Corrmap hence takes at least a list of ICA solutions and a
template, that can be an index or an array. As we don&#8217;t have different
subjects or runs available today, here we will fit ICA models to different
parts of the recording and then use as a user-defined template the ICA
that we just fitted for detecting corresponding components in the three &#8220;new&#8221;
ICAs. The following block of code addresses this point and should not be
copied, ok?
We&#8217;ll start by simulating a group of subjects or runs from a subject</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">times</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">intervals</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.10.1/reference/generated/numpy.linspace.html#numpy.linspace"><span class="n">np</span><span class="o">.</span><span class="n">linspace</span></a><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">icas_from_other_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="n">raw</span><span class="o">.</span><span class="n">pick_types</span><span class="p">(</span><span class="n">meg</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">eeg</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>  <span class="c1"># take only MEG channels</span>
<span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">start</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">intervals</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">intervals</span><span class="p">):</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">intervals</span><span class="p">[</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;fitting ICA from {0} to {1} seconds&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">))</span>
        <span class="n">this_ica</span> <span class="o">=</span> <a href="../generated/mne.preprocessing.ICA.html#mne.preprocessing.ICA"><span class="n">ICA</span></a><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
            <span class="n">raw</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">,</span> <span class="n">reject</span><span class="o">=</span><span class="n">reject</span><span class="p">)</span>
        <span class="n">icas_from_other_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_ica</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-python"><div class="highlight"><pre>fitting ICA from 0 to 13899 seconds
fitting ICA from 13899 to 27799 seconds
fitting ICA from 27799 to 41699 seconds
</pre></div>
</div>
<p>Do not copy this at home! You start by reading in a collections of ICA
solutions, something like</p>
<p><tt class="docutils literal"><span class="pre">icas</span> <span class="pre">=</span> <span class="pre">[mne.preprocessing.read_ica(fname)</span> <span class="pre">for</span> <span class="pre">fname</span> <span class="pre">in</span> <span class="pre">ica_fnames]</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span><span class="p">(</span><span class="n">icas_from_other_data</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-python"><div class="highlight"><pre>[&lt;ICA  |  raw data decomposition, fit (fastica): 13545 samples, 25 components, channels used: &quot;mag&quot;; &quot;grad&quot;&gt;, &lt;ICA  |  raw data decomposition, fit (fastica): 13545 samples, 25 components, channels used: &quot;mag&quot;; &quot;grad&quot;&gt;, &lt;ICA  |  raw data decomposition, fit (fastica): 13846 samples, 25 components, channels used: &quot;mag&quot;; &quot;grad&quot;&gt;]
</pre></div>
</div>
<p>use our previous ICA as reference.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">reference_ica</span> <span class="o">=</span> <span class="n">ica</span>
</pre></div>
</div>
<p>Investigate our reference ICA, here we use the previous fit from above.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">reference_ica</span><span class="o">.</span><span class="n">plot_components</span><span class="p">()</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><a class="first reference internal image-reference" href="../_images/sphx_glr_plot_artifacts_correction_ica_006.png"><img alt="../_images/sphx_glr_plot_artifacts_correction_ica_006.png" src="../_images/sphx_glr_plot_artifacts_correction_ica_006.png" style="width: 347.8px; height: 329.0px;" /></a>
</li>
<li><a class="first reference internal image-reference" href="../_images/sphx_glr_plot_artifacts_correction_ica_007.png"><img alt="../_images/sphx_glr_plot_artifacts_correction_ica_007.png" src="../_images/sphx_glr_plot_artifacts_correction_ica_007.png" style="width: 347.8px; height: 117.5px;" /></a>
</li>
</ul>
<p>Which one is the bad EOG component?
Here we rely on our previous detection algorithm. You will need to decide
yourself in that situation where no other detection is available.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">reference_ica</span><span class="o">.</span><span class="n">plot_sources</span><span class="p">(</span><span class="n">eog_average</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">eog_inds</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_artifacts_correction_ica_008.png" class="align-center" src="../_images/sphx_glr_plot_artifacts_correction_ica_008.png" />
<p>Indeed it looks like an EOG, also in the average time course.</p>
<p>So our template shall be a tuple like (reference_run_index, component_index):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">template</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">eog_inds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<p>Now we can do the corrmap.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fig_template</span><span class="p">,</span> <span class="n">fig_detected</span> <span class="o">=</span> <span class="n">corrmap</span><span class="p">(</span>
    <span class="n">icas_from_other_data</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="n">template</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;blinks&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">threshold</span><span class="o">=.</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch_type</span><span class="o">=</span><span class="s1">&#39;mag&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><a class="first reference internal image-reference" href="../_images/sphx_glr_plot_artifacts_correction_ica_009.png"><img alt="../_images/sphx_glr_plot_artifacts_correction_ica_009.png" src="../_images/sphx_glr_plot_artifacts_correction_ica_009.png" style="width: 347.8px; height: 117.5px;" /></a>
</li>
<li><a class="first reference internal image-reference" href="../_images/sphx_glr_plot_artifacts_correction_ica_010.png"><img alt="../_images/sphx_glr_plot_artifacts_correction_ica_010.png" src="../_images/sphx_glr_plot_artifacts_correction_ica_010.png" style="width: 347.8px; height: 117.5px;" /></a>
</li>
</ul>
<p>Nice, we have found similar ICs from the other runs!
This is even nicer if we have 20 or 100 ICA solutions in a list.</p>
<p>You can also use SSP for correcting for artifacts. It is a bit simpler,
faster but is less precise than ICA. And it requires that you
know the event timing of your artifact.
See <a class="reference internal" href="plot_artifacts_correction_ssp.html#tut-artifacts-correct-ssp"><em>Artifact Correction with SSP</em></a>.</p>
<p><strong>Total running time of the script:</strong>
(0 minutes 45.190 seconds)</p>
<div class="sphx-glr-download container">
<strong>Download Python source code:</strong> <a class="reference download internal" href="../_downloads/plot_artifacts_correction_ica.py"><tt class="xref download docutils literal"><span class="pre">plot_artifacts_correction_ica.py</span></tt></a></div>
<div class="sphx-glr-download container">
<strong>Download IPython notebook:</strong> <a class="reference download internal" href="../_downloads/plot_artifacts_correction_ica.ipynb"><tt class="xref download docutils literal"><span class="pre">plot_artifacts_correction_ica.ipynb</span></tt></a></div>
</div>
</div>


    </div>
    
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright 2012-2016, MNE Developers. Last updated on 2016-05-11.<br/>
    </p>
  </div>
</footer>
  </body>
</html>