<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>mne.compute_covariance &mdash; MNE 0.12.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.3.4/flatly/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.12.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="MNE 0.12.0 documentation" href="../index.html" />
    <link rel="up" title="Python API Reference" href="../python_reference.html" />
    <link rel="next" title="mne.compute_raw_covariance" href="mne.compute_raw_covariance.html" />
    <link rel="prev" title="mne.rename_channels" href="mne.rename_channels.html" />

<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700' rel='stylesheet' type='text/css'>


    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37225609-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>



    <script type="text/javascript">
    !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);
    js.id=id;js.src="http://platform.twitter.com/widgets.js";
    fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
    </script>



    <script type="text/javascript">
    (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
    </script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><img src="../_static/mne_logo_small.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>0.12.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../getting_started.html">Get started</a></li>
                <li><a href="../tutorials.html">Tutorials</a></li>
                <li><a href="../auto_examples/index.html">Gallery</a></li>
                <li><a href="../python_reference.html">API</a></li>
                <li><a href="../manual/index.html">Manual</a></li>
                <li><a href="../faq.html">FAQ</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../auto_examples/index.html">Examples Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contribute to MNE</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../python_reference.html">Python API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../manual/index.html">User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whats_new.html">What&#8217;s new</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cite.html">How to cite MNE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">Related publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cited.html">Publications from MNE users</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">mne.compute_covariance</a></li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/mne_logo_small.png" alt="Logo"/>
            </a></p><ul>
<li><a class="reference internal" href="#">mne.compute_covariance</a></li>
</ul>

  <li>
    <a href="mne.rename_channels.html" title="Previous Chapter: mne.rename_channels"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; mne.rename_ch...</span>
    </a>
  </li>
  <li>
    <a href="mne.compute_raw_covariance.html" title="Next Chapter: mne.compute_raw_covariance"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">mne.compute_r... &raquo;</span>
    </a>
  </li>
<form action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="col-md-12">
      
  <div class="section" id="mne-compute-covariance">
<h1>mne.compute_covariance<a class="headerlink" href="#mne-compute-covariance" title="Permalink to this headline">¶</a></h1>
<dl class="function">
<dt id="mne.compute_covariance">
<tt class="descclassname">mne.</tt><tt class="descname">compute_covariance</tt><big>(</big><em>epochs</em>, <em>keep_sample_mean=True</em>, <em>tmin=None</em>, <em>tmax=None</em>, <em>projs=None</em>, <em>method='empirical'</em>, <em>method_params=None</em>, <em>cv=3</em>, <em>scalings=None</em>, <em>n_jobs=1</em>, <em>return_estimators=False</em>, <em>verbose=None</em><big>)</big><a class="headerlink" href="#mne.compute_covariance" title="Permalink to this definition">¶</a></dt>
<dd><p>Estimate noise covariance matrix from epochs.</p>
<p>The noise covariance is typically estimated on pre-stim periods
when the stim onset is defined from events.</p>
<p>If the covariance is computed for multiple event types (events
with different IDs), the following two options can be used and combined:</p>
<blockquote>
<div><ol class="arabic simple">
<li>either an Epochs object for each event type is created and
a list of Epochs is passed to this function.</li>
<li>an Epochs object is created for multiple events and passed
to this function.</li>
</ol>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Baseline correction should be used when creating the Epochs.
Otherwise the computed covariance matrix will be inaccurate.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For multiple event types, it is also possible to create a
single Epochs object with events obtained using
merge_events(). However, the resulting covariance matrix
will only be correct if keep_sample_mean is True.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The covariance can be unstable if the number of samples is
not sufficient. In that case it is common to regularize a
covariance estimate. The <tt class="docutils literal"><span class="pre">method</span></tt> parameter of this
function allows to regularize the covariance in an
automated way. It also allows to select between different
alternative estimation algorithms which themselves achieve
regularization. Details are described in <a class="reference internal" href="#r13" id="id1">[R13]</a>.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>epochs</strong> : instance of Epochs, or a list of Epochs objects</p>
<blockquote>
<div><p>The epochs.</p>
</div></blockquote>
<p><strong>keep_sample_mean</strong> : bool (default True)</p>
<blockquote>
<div><p>If False, the average response over epochs is computed for
each event type and subtracted during the covariance
computation. This is useful if the evoked response from a
previous stimulus extends into the baseline period of the next.
Note. This option is only implemented for method=&#8217;empirical&#8217;.</p>
</div></blockquote>
<p><strong>tmin</strong> : float | None (default None)</p>
<blockquote>
<div><p>Start time for baseline. If None start at first sample.</p>
</div></blockquote>
<p><strong>tmax</strong> : float | None (default None)</p>
<blockquote>
<div><p>End time for baseline. If None end at last sample.</p>
</div></blockquote>
<p><strong>projs</strong> : list of Projection | None (default None)</p>
<blockquote>
<div><p>List of projectors to use in covariance calculation, or None
to indicate that the projectors from the epochs should be
inherited. If None, then projectors from all epochs must match.</p>
</div></blockquote>
<p><strong>method</strong> : str | list | None (default &#8216;empirical&#8217;)</p>
<blockquote>
<div><p>The method used for covariance estimation. If &#8216;empirical&#8217; (default),
the sample covariance will be computed. A list can be passed to run a
set of the different methods.
If &#8216;auto&#8217; or a list of methods, the best estimator will be determined
based on log-likelihood and cross-validation on unseen data as
described in <a class="reference internal" href="#r13" id="id2">[R13]</a>. Valid methods are:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">'empirical'</span></tt>: the empirical or sample covariance</li>
<li><tt class="docutils literal"><span class="pre">'diagonal_fixed'</span></tt>: a diagonal regularization as in
mne.cov.regularize (see MNE manual)</li>
<li><tt class="docutils literal"><span class="pre">'ledoit_wolf'</span></tt>: the Ledoit-Wolf estimator <a class="reference internal" href="#r14" id="id3">[R14]</a></li>
<li><tt class="docutils literal"><span class="pre">'shrunk'</span></tt>: like &#8216;ledoit_wolf&#8217; with cross-validation for
optimal alpha (see scikit-learn documentation on covariance
estimation)</li>
<li><tt class="docutils literal"><span class="pre">'pca'</span></tt>: probabilistic PCA with low rank <a class="reference internal" href="#r15" id="id4">[R15]</a></li>
<li><tt class="docutils literal"><span class="pre">'factor_analysis'</span></tt>: Factor Analysis with low rank <a class="reference internal" href="#r16" id="id5">[R16]</a></li>
</ul>
</div></blockquote>
<p>If <tt class="docutils literal"><span class="pre">'auto'</span></tt>, this expands to:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="s1">&#39;shrunk&#39;</span><span class="p">,</span> <span class="s1">&#39;diagonal_fixed&#39;</span><span class="p">,</span> <span class="s1">&#39;empirical&#39;</span><span class="p">,</span> <span class="s1">&#39;factor_analysis&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><tt class="docutils literal"><span class="pre">'ledoit_wolf'</span></tt> and <tt class="docutils literal"><span class="pre">'pca'</span></tt> are similar to
<tt class="docutils literal"><span class="pre">'shrunk'</span></tt> and <tt class="docutils literal"><span class="pre">'factor_analysis'</span></tt>, respectively. They are not
included to avoid redundancy. In most cases <tt class="docutils literal"><span class="pre">'shrunk'</span></tt> and
<tt class="docutils literal"><span class="pre">'factor_analysis'</span></tt> represent more appropriate default
choices.</p>
</div>
<p>The <tt class="docutils literal"><span class="pre">'auto'</span></tt> mode is not recommended if there are many
segments of data, since computation can take a long time.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 0.9.0.</span></p>
</div>
</div></blockquote>
<p><strong>method_params</strong> : dict | None (default None)</p>
<blockquote>
<div><p>Additional parameters to the estimation procedure. Only considered if
method is not None. Keys must correspond to the value(s) of <cite>method</cite>.
If None (default), expands to:</p>
<div class="highlight-python"><div class="highlight"><pre>&#39;empirical&#39;: {&#39;store_precision&#39;: False, &#39;assume_centered&#39;: True},
&#39;diagonal_fixed&#39;: {&#39;grad&#39;: 0.01, &#39;mag&#39;: 0.01, &#39;eeg&#39;: 0.0,
                   &#39;store_precision&#39;: False,
                   &#39;assume_centered&#39;: True},
&#39;ledoit_wolf&#39;: {&#39;store_precision&#39;: False, &#39;assume_centered&#39;: True},
&#39;shrunk&#39;: {&#39;shrinkage&#39;: np.logspace(-4, 0, 30),
           &#39;store_precision&#39;: False, &#39;assume_centered&#39;: True},
&#39;pca&#39;: {&#39;iter_n_components&#39;: None},
&#39;factor_analysis&#39;: {&#39;iter_n_components&#39;: None}
</pre></div>
</div>
</div></blockquote>
<p><strong>cv</strong> : int | sklearn cross_validation object (default 3)</p>
<blockquote>
<div><p>The cross validation method. Defaults to 3, which will
internally trigger a default 3-fold shuffle split.</p>
</div></blockquote>
<p><strong>scalings</strong> : dict | None (default None)</p>
<blockquote>
<div><p>Defaults to <tt class="docutils literal"><span class="pre">dict(mag=1e15,</span> <span class="pre">grad=1e13,</span> <span class="pre">eeg=1e6)</span></tt>.
These defaults will scale magnetometers and gradiometers
at the same unit.</p>
</div></blockquote>
<p><strong>n_jobs</strong> : int (default 1)</p>
<blockquote>
<div><p>Number of jobs to run in parallel.</p>
</div></blockquote>
<p><strong>return_estimators</strong> : bool (default False)</p>
<blockquote>
<div><p>Whether to return all estimators or the best. Only considered if
method equals &#8216;auto&#8217; or is a list of str. Defaults to False</p>
</div></blockquote>
<p><strong>verbose</strong> : bool | str | int | or None (default None)</p>
<blockquote>
<div><p>If not None, override default verbose level (see mne.verbose).</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>cov</strong> : instance of Covariance | list</p>
<blockquote class="last">
<div><p>The computed covariance. If method equals &#8216;auto&#8217; or is a list of str
and return_estimators equals True, a list of covariance estimators is
returned (sorted by log-likelihood, from high to low, i.e. from best
to worst).</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<dl class="last docutils">
<dt><a class="reference internal" href="mne.compute_raw_covariance.html#mne.compute_raw_covariance" title="mne.compute_raw_covariance"><tt class="xref py py-obj docutils literal"><span class="pre">compute_raw_covariance</span></tt></a></dt>
<dd>Estimate noise covariance from raw data</dd>
</dl>
</div>
<p class="rubric">References</p>
<table class="docutils citation" frame="void" id="r13" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[R13]</td><td><em>(<a class="fn-backref" href="#id1">1</a>, <a class="fn-backref" href="#id2">2</a>, <a class="fn-backref" href="#id6">3</a>)</em> Engemann D. and Gramfort A. (2015) Automated model selection in
covariance estimation and spatial whitening of MEG and EEG
signals, vol. 108, 328-342, NeuroImage.</td></tr>
</tbody>
</table>
<table class="docutils citation" frame="void" id="r14" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[R14]</td><td><em>(<a class="fn-backref" href="#id3">1</a>, <a class="fn-backref" href="#id7">2</a>)</em> Ledoit, O., Wolf, M., (2004). A well-conditioned estimator for
large-dimensional covariance matrices. Journal of Multivariate
Analysis 88 (2), 365 - 411.</td></tr>
</tbody>
</table>
<table class="docutils citation" frame="void" id="r15" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[R15]</td><td><em>(<a class="fn-backref" href="#id4">1</a>, <a class="fn-backref" href="#id8">2</a>)</em> Tipping, M. E., Bishop, C. M., (1999). Probabilistic principal
component analysis. Journal of the Royal Statistical Society:
Series B (Statistical Methodology) 61 (3), 611 - 622.</td></tr>
</tbody>
</table>
<table class="docutils citation" frame="void" id="r16" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[R16]</td><td><em>(<a class="fn-backref" href="#id5">1</a>, <a class="fn-backref" href="#id9">2</a>)</em> Barber, D., (2012). Bayesian reasoning and machine learning.
Cambridge University Press., Algorithm 21.1</td></tr>
</tbody>
</table>
</dd></dl>

<div style='clear:both'></div></div>


    </div>
    
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright 2012-2016, MNE Developers. Last updated on 2016-05-11.<br/>
    </p>
  </div>
</footer>
  </body>
</html>